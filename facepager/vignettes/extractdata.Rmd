---
title: "extractdata"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{extractdata}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(dplyr)
library(tidyverse)
```

```{r setup}
# library(devtools)
# install_github("strohne/datavana/facepager")
library(facepager)

# Load example data
example <- read_csv2(system.file("extdata", "exampledata.csv", package = "facepager"))
```


Now you can access the various functions that allow you to go deeper into the different data levels. Even though the explanations of the functions appear here in a certain order, this does not mean that this is a chronological approach. Rather, the functions should be seen on one level. Depending on the scientific interest, one or the other functions are then more likely to be considered.


As you may already know, Facepager always collects data on multiple levels, also called parent and child levels (https://github.com/strohne/Facepager/wiki/URLs,-Placeholders,-Nodes-and-Keys#nodes). The following functions mostly refer to these terms.


### Get the number of childnodes for each node shown in Facepager with `fp_children_bynode()`

First of all, you can view how many child nodes were collected per object ID/parent node. With `fp_children_bynode()` you get the exact number of children per "parent_objectid". Additionally you get the position of the dataset in Facepager with "parent_no" and a boxplot for the distribution of the number of children.

```{r}
fp_children_bynode(example)

# Fehlermeldung:
# Error in UseMethod("filter") : 
# no applicable method for 'filter' applied to an object of class "function"
```

This number includes all children of a parent, including duplicates.


### Count the number of different children per Object ID (without duplicates) with `fp_childcount()`

If you want to find out how many single or different children an Object ID produces, you can use `fp_childcount()`. Using this function, the duplicates are not included in the count.

```{r}
childcount <- fp_childcount(example)
print(childcount)

# Fehlermeldung:
# Error in UseMethod("filter") : 
# no applicable method for 'filter' applied to an object of class "function"
```

The duplicates that are excluded here are considered with `fp_duplicates()`.



### Get the collected data per Object ID with `fp_children()`

`fp_children()` gives you not only the number of children per Object ID, but also:

* the number of offcuts and the last cursor of the pagination per object ID

* the first and last date of the children per object ID

* if children are missing (if there is a target, how many children should be collected)

```{r}
children <- fp_children(example)
print(children)
# hier klappt irgendwas nicht, hier wird mir beim testen dieselbe tibble angezeigt wie bei childcount
# was muss denn hier als Parameter hin? man muss die genauen columns angeben für target, paginierung und created oder?

# Fehlermeldung:
# Error in UseMethod("filter") : 
# no applicable method for 'filter' applied to an object of class "function"

```


### Get the number of childnodes for each seed for a certain period of time with `fp_nodesperseed()`

If you want to look more closely at a certain period of time, you can use `fp_nodesperseed()`. This function makes it possible to specify an exact daterange (e.g. `daterange = ymd(c("2019-11-01","2020-02-01"),tz="Europe/Berlin"`) and get exactly for it the children per parent (without duplicates).

```{r}
fp_nodesperseed(example,
                daterange = ymd(c("2022-11-01","2022-11-02"), tz="Europe/Berlin"),
                col_created = quo(created_time))

# Fehlermeldung:
# Error in `inner_join()`:
# ! Can't join on `x$parent_id` x `y$parent_id` because of incompatible types.
# ℹ `x$parent_id` is of type <character>>.
# ℹ `y$parent_id` is of type <double>>.

```


### Get the Object IDs  and number of parent nodes with `fp_getparents()`

`fp_getparents()` can be used to get details about the parents. You get an overview of 

* which object IDs were used ("parent_objectid"), 

* which position they have in the facepager request ("parent_no")

* and which ID they have been assigned to ("parent_id"). 

```{r}
fp_getparents(example)

# Fehlermeldung:
# Error in UseMethod("filter") : 
# no applicable method for 'filter' applied to an object of class "function"
```


### Evaluate duplicates on different node levels `fp_duplicates()`

`fp_duplicates()` extracts duplicates at three different levels:

1. At the parent level,

2. on the level of the children with the same parent/seed,

3. on the level of the children independent of the parent.

```{r}
fp_duplicates(example)

# Fehlermeldung:
# Error in UseMethod("filter") : 
# no applicable method for 'filter' applied to an object of class "function"
```

